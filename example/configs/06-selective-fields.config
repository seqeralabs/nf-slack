/*
 * EXAMPLE 6: Selective Default Fields
 *
 * Choose which built-in workflow information fields to include in messages.
 * By default, the plugin includes all available information.
 * Use includeFields to select only what you want.
 *
 * New features in this example:
 * - includeFields: array of field names to include
 */

plugins {
    id 'nf-slack@0.3.0'
}

slack {
    // Option A: Bot User
    bot {
        token = System.getenv('SLACK_BOT_TOKEN')
        channel = System.getenv('SLACK_CHANNEL_ID')
    }

    // Option B: Webhook
    // webhook {
    //     url = System.getenv('SLACK_WEBHOOK_URL')
    // }

    // Start message: only show run name and status
    onStart {
        enabled = true
        message = [
            includeFields: ['runName', 'status']
            // Excludes: commandLine, workDir (available for start messages)
        ]
    }

    // Completion message: show run name, duration, status, and task counts
    onComplete {
        enabled = true
        message = [
            includeFields: ['runName', 'duration', 'status', 'tasks']
            // Excludes: commandLine (available for completion messages)
        ]
    }

    // Error message: show everything available for debugging
    onError {
        enabled = true
        message = [
            includeFields: ['runName', 'duration', 'errorMessage', 'failedProcess']
            // Excludes: commandLine (available for error messages)
        ]
    }
}

// Available includeFields options:
//
// ALL messages:
// - 'runName'      : Nextflow run name
// - 'status'       : Workflow status with emoji
//
// START messages only:
// - 'commandLine'  : Command used to launch workflow
// - 'workDir'      : Work directory path
//
// COMPLETE messages only:
// - 'duration'     : How long the workflow ran
// - 'tasks'        : Task statistics (cached, completed, failed)
//
// ERROR messages only:
// - 'duration'       : How long before failure
// - 'errorMessage'   : Error details
// - 'failedProcess'  : Which process failed
//
// Note: If includeFields is not specified, default behavior varies:
// - Without map config: all fields included
// - With map config but no includeFields: NO fields included
//   (only custom fields if specified)
